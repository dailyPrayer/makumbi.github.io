title=Software Vulnerability - SQL Injection
date=2017-01-08
type=post
tags=blog
status=published
~~~~~~

![insecure login](/img/protect-against-sql-injection.png)

In this article I create a simple form to demonstrate insecure interaction between a java based component 
and the outside world explaining why the form poses as a vulnerability to the overall application. 
Finally, I show how to properly secure the application. 

A simple Java application is created with a simple login form that retrieves username and password using 
two JTextFields and storing them into the Derby Database.

![insecure login](/img/insecure-login.png)

Once login button is pressed username and password is sent to be stored the DB.
 
**Note:** The simple login application does not take into account other software vulnerabilities. 
We’re only demonstrating SQL Injection vulnerability. 

![insecure login storing](/img/insecure-login-storing.png)

The application works great, but when we take a look under the hood we find that this application is vulnerable 
to SQL Injection attacks because SQL statements are not prepared and are dynamically storing data directly into 
the database. 
 
### Insecure Code
------

````
 private static void insertUserInfor(String userName, String userPass)
    {
        try
        {
            createConnection();
            stmt = conn.createStatement();
            stmt.execute("insert into " + tableName + " values ('" +
                    userName + "', '" + userPass + "')");
            
            stmt.close();
        }
        catch (SQLException sqlExcept)
        {
            sqlExcept.printStackTrace();
        }
    }
````

SQL Injection attacks are the most prevent attacks to an application and inflicts the most damage exposing 
sensitive data. Injection attacks attempt to break into application databases by injecting malicious code, 
oftentimes in a form of SQL statements. They are often injected through form fields similar to the small 
application I created, but are also injected through uploads, 3rd party APIs, configuration files, input files etc. 

### Secured Code
--------

The code snippet above shows the application retrieving username and password directly placing it into the SQL 
statement without validating or sanitizing the data. Essentially, the developer trusts the user not to 
inject malicious code. The user should never be trusted. Below I demonstrate how to properly prepare SQL statements 
in java. 

````
private static void insertUserInfor(String userName, String userPass)
    {
        try
        { 
            // establish connection
            createConnection();
            String qTxt = "INSERT INTO " + tableName + "VALUES (?,?)";
            prepStmt = conn.prepareStatement(qTxt);
            prepStmt.setString(1, userName);
            prepStmt.setString(1, userPass);
            
            prepStmt.close();
        }
        catch (SQLException sqlExcept)
        {
            sqlExcept.printStackTrace();
        }
    }
````

When SQL statements are prepared information received from the user is placed in a prepared statement and not directly 
into the SQL query, thus mitigating dynamic queries. 

In this demonstration, I have alluded to mention another measure to take in order to mitigate SQL Injection attacks, 
which is to validate and sanitize data retrieved from the user. As we’ve mentioned, the application cannot trust data 
from the outside world. Information must be validated for content, length, format, and other factors before use. 
